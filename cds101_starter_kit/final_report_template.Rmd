---
title: "CDS 101 – Final Project Report"
author: "Ankith Kolapalli, Julia Conway, Ruhama"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    css: "gmu-cds101.css"
    toc: true
    toc_depth: 3
    number_sections: true
  pdf_document:
    toc: true
---



# 1. Problem Definition

The question that our group is investigating explores how the fuel economy has changed in United States vehicles from 2005 to 2020. Our specific research question is "Which car features, like mileage, price, engine type, etc, have the strongest effect on vehicle price?"

This question is interesting because it allows us to see trends and patterns between different variables like engine type and mileage in relation to the price of the vehicle as a whole.

Our main objectives include cleaning the data, fixing missing values, and creating visualizations such as bar plots and scatter plots.

Key assumptions that we have made are that certain features, especially car year, mileage, and engine size will strongly relate to price. Newer cars and cars with bigger engines will cost more, while cars with high mileage will usually be priced lower. Fuel type and transmission also show clear price differences. Overall, we expect the multiple regression model to perform better than the simple model because it captures more variables that influence price.

# 2. Data Acquisition & Description

Data Set Name: CarDekho Vehicle Dataset
Source: Kaggle (https://www.kaggle.com/datasets/nehalbirla/vehicle-dataset-from-cardekho)
Variable description: the dataset has car features like brand, body type, engine type, distance, registration, and price.  
Size: around 4,300 rows with 9 coloumns  


```{r}
library(readr)
library(dplyr)
library(ggplot2)
cars_raw <- read_csv("data/cars_data.csv")
```

# 3. Data Cleaning & Preprocessing

Data Cleaning & Preprocessing
Describe the steps you took to make the data usable, for example:
 Steps that we have taken to make the data usable include...
 - filtering
 - renaming
 - mutating


```{r}
cars_clean <- cars_raw %>%
  filter(!is.na(Price), !is.na(Brand)) %>% 
  rename(EngineType = `Engine Type`) %>% 
  mutate(Brand = factor(Brand),
         Body = factor(Body),
         EngineType = factor(EngineType),
         Registration = factor(Registration)
  )
```

# 4. Exploratory Data Analysis (EDA)

This section maps directly to the **EDA** part of the rubric:

- Summary statistics  
- Visualizations  
- Interpretation connected to the research question  

```{r}
library(dplyr)
summary(cars_clean)
```


```{r}
ggplot(cars_clean) +
  geom_histogram(mapping = aes(x = Price),binwidth = 2000,color = "black",fill  = "blue") +
  coord_cartesian(xlim = c(0, 40000)) +
  labs(title = "Histogram of Used Car Prices",
       x = "Price",
       y = "Count"
  )
```


```{r}
ggplot(cars_clean) +
  geom_histogram(mapping = aes(x = Mileage),binwidth = 18,color = "black",fill  = "green") +
  labs(title = "Histogram of Car Mileage",
       x = "Mileage",
       y = "Count"
  )
```
```{r}
avg_price<- cars_clean %>%
  group_by(Brand) %>%
  summarise(mean_price = mean(Price, na.rm = TRUE)) %>%
  arrange(mean_price)

ggplot(avg_price) +
  geom_col(mapping = aes(x = Brand, y = mean_price, fill = "pink")) +
  labs(title = "Average Used Car Price by Brand",
       x = "Brand",
       y = "Average Price"
  )
```
```{r}
ggplot(cars_clean) +
  geom_point(mapping = aes(x = Mileage, y = Price),
    alpha = 0.4) +
  labs(title = "Relationship Between Mileage and Price",
       x = "Mileage",
       y = "Price"
  )
```
```{r}
ggplot(cars_clean) +
  geom_boxplot(mapping = aes(x = Body, y = Price)) +
  coord_cartesian(ylim = c(0, 200000)) +
  labs(title = "Distribution of Car Prices by Body Type",
       x = "Body Type",
       y = "Price"
  )
```
# 5. Visualization Quality and Storytelling

Histograms specifically help us to visualize distributions within our data set which can help us understand how our outlined variables affect vehicle pricing. Utilizing bar graphs helped us see how the average prices changed across specific car models, and scatter plotting helped us visualize what kind of influence our variables had over increasing or decreasing prices. Boxplots are appropriate to our research as well because they illustrate outliers, and help us see things like the median and maximum values easier.

Upon making our graphs, we tried our best to use titles that were an accurate depiction of what the graph was showcasing as well as labeling our axis concisely. Ultimately we didn't really make use of many legends because most of our graphs were very simplistic and didn't require one... for example our first and second graphs only contained one variable and one color. Similar to this, our color choices were very straight forward and were chosen ensure readability and deter any confusion.

Additionally, we used increments in our graphs that were simplistic and appropriate for mileage and price...the price went up in increments of 10,000 and the mileage went up in increments of 250. For the different car models we used no more than seven to ensure that we weren't decreasing the legitimacy of our analysis by having too many areas of focus.

# 6. Modeling Approach

Since our outcome variable we chose was price and its numeric and continuous, a regression model seemed the most appropriate.
We started with a Baseline model and its prupose was to set a reference point for our real model should do better than to be somewhat useful.
The baseline predicted the average price of all cars in the training set for every car in the test. It didn't use any specific features and was a simple guess average.
After our baseline we made or main model which was a multiple linear regression model. It let us look at different features that each had a part in predicting a cars price. Since linear regression is a lot more easier to understand it works best with categorical predictors and values and it was many times throughout the class. By comparing the RMSE and the R^2 of the linear model against the basline we were able to look at how much better our model was perfoming compared to the simple average based prediction.


# 7. Model Implementation & Evaluation

Our model used Mileage, Enginev, and Year as numeric predictors and Brand, Bodytype, and Enginetype as categorical. They were chose becuase they're the most common factors that would influence a cars market value.

We split the data into 80% training set and 20% testing. It let us fit the model on the majority of the dat set
and look at how well it can generalize to the cars that are unseen by it.

- Metrics used 
The Baseline predicted the average price from the training set for every car in the test set.
It helps us just have a benchmark that we should try to beat with our model.
Our baseline RMSE was 23,146.9 which means the guess is off by around 23k on average.

We built a multiple linear regression model predicting price based on numeric and categorical predictors.
Linear regressions works best becuase our target Price is numeric as well. After training our linear model the RMSE was 16,786.2 which is a lot lower than the baseline.

This meant our model was doing better, and the adjusted R² was 0.4376 which means about 43.8% of the variation in car prices was explained by the  

The multiple linear regression model clearly did better the baseline model, lowering the error by over $6,000 on average.
The adjusted R² shows our model explains a meaningful part of price variation but doesn't grab  everything.
This makes sense because real-world car pricing depends on so many other factors that aren't part of the data set like car condition, past accidents, location, seller, etc.
The RMSE and R² together say that the model is useful but not perfect which is something consistent with these types of data sets.


```{r}
set.seed(321)
train_index <- sample(seq_len(nrow(cars_clean)), size = 0.8 * nrow(cars_clean))
train <- cars_clean[train_index, ]
test  <- cars_clean[-train_index, ]

baseline <- mean(train$Price, na.rm = TRUE)
baseline_preds <- rep(baseline, nrow(test))
baseline_rmse <- sqrt(mean((test$Price - baseline_preds)^2, na.rm = TRUE))
baseline_rmse

model <- lm(Price ~ Mileage + Brand + Body + EngineV + EngineType + Year,data = train)
preds <- predict(model, newdata = test)
rmse <- sqrt(mean((test$Price - preds)^2, na.rm = TRUE))
rmse



summary(model)$adj.r.squared 
```

# 8. Conclusions & Recommendations

As mileage increases, our price variable decreases significantly and vehicles that are high in price are typically low in mileage which we expected to see. Companies like Mercedes, BMW, and Audi are also tend to be higher in price than companies like Toyota and Volkswagen. The distribution of our price histograms are generally right skewed and our mileage graphs are also skewed, showing and average mileage but also a stretch of high mileage vehicles too. Our two biggest predictors of price included mileage and brand as our findings showed a significant relationship between vehicles with a higher price having lower mileage (the scatter plot is a great representation of this takeaway). Additionally, the bar graph showcases price among specified higher and lower end brands. This helps us conclude that car prices are directly impacted by how far they have been driven and the status of the manufacturer. Some limitations include that price can vary among vehicles even if they are the same brand and model due to the specific packages that are bought (heated seats, leather..ect. Another limitation could be that we don't have representative sample sizes to actually prove if our data is significant or not. Extensions for future work could examine more closely specific types of engines or fuel types to get a more diversified data set.

# 9. Code Quality & Reproducibility

To make sure our results can be reproduced by anyone all of our analysis is in the markdown file which loads our dataset, cleans it,
graph the visualizations, and runs the test models. 
The required R packages are mainly dplyr, ggplot2, and tidyverse.

```{r session-info, echo=FALSE}
sessionInfo()
```

# 10. References

Used car dataset from Kaggle:(https://www.kaggle.com/datasets/nehalbirla/vehicle-dataset-from-cardekho)

CDS 101 textbook and class materials for help on data cleaning, visualization, and modeling

Introduction to Linear Regression concepts from the CDS 101 textbook: https://cdsbook.github.io/book/

ggplot2 documentation: https://ggplot2.tidyverse.org/

R Markdown documentation: https://rmarkdown.rstudio.com/

